<?php
use Illuminate\Database\Migrations\Migration; use Illuminate\Database\Schema\Blueprint; use Illuminate\Support\Facades\Schema; return new class extends Migration{ public function up():void{ Schema::create('rooms',function(Blueprint $t){$t->id();$t->string('code',8)->unique();$t->enum('status',['waiting','dealing','playing','finished'])->default('waiting');$t->unsignedTinyInteger('trump_method')->default(1);$t->json('settings')->nullable();$t->timestamps();}); Schema::create('players',function(Blueprint $t){$t->id();$t->foreignId('room_id')->constrained()->cascadeOnDelete();$t->foreignId('user_id')->nullable()->constrained()->nullOnDelete();$t->string('name');$t->string('seat')->nullable();$t->string('partner_seat')->nullable();$t->string('device_id')->nullable();$t->string('avatar')->nullable();$t->timestamps();}); Schema::create('games',function(Blueprint $t){$t->id();$t->foreignId('room_id')->constrained()->cascadeOnDelete();$t->unsignedInteger('hand_no')->default(1);$t->enum('phase',['five_card_phase','full_deal','playing','scoring'])->default('five_card_phase');$t->string('dealer_seat');$t->string('turn_seat');$t->string('trump_suit')->nullable();$t->json('deck');$t->json('hands');$t->json('centre_pile')->default('[]');$t->json('last_trick')->default('[]');$t->json('tricks_taken')->default('{"N":0,"E":0,"S":0,"W":0}');$t->json('tens_taken')->default('{"NS":0,"EW":0}');$t->json('consecutive_hands')->default('{"NS":0,"EW":0}');$t->json('kots')->default('{"NS":0,"EW":0}');$t->string('next_dealer_seat')->nullable();$t->timestamps();}); Schema::create('moves',function(Blueprint $t){$t->id();$t->foreignId('game_id')->constrained()->cascadeOnDelete();$t->string('seat');$t->string('card');$t->unsignedInteger('trick_index');$t->timestamps();}); } public function down():void{ Schema::dropIfExists('moves'); Schema::dropIfExists('games'); Schema::dropIfExists('players'); Schema::dropIfExists('rooms'); } };
