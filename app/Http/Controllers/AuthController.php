<?php
namespace App\Http\Controllers; use App\Models\User; use Illuminate\Http\Request; use Illuminate\Support\Facades\Hash; use Illuminate\Support\Str; class AuthController extends Controller{ public function register(Request $r){ $data=$r->validate(['name'=>['required','string','max:80'],'email'=>['required','email','max:120','unique:users,email'],'password'=>['required','string','min:6'],'username'=>['required','alpha_num','min:3','max:20','unique:users,username'],'avatar'=>['nullable','string','max:255'],]); $user=User::create(['name'=>$data['name'],'email'=>$data['email'],'password'=>Hash::make($data['password']),'username'=>Str::lower($data['username']),'avatar'=>$data['avatar']??null,]); $token=$user->createToken('auth')->plainTextToken; return response()->json(['token'=>$token,'user'=>$user],201);} public function login(Request $r){ $creds=$r->validate(['login'=>['required','string'],'password'=>['required','string'],]); $user=User::where('email',$creds['login'])->orWhere('username',Str::lower($creds['login']))->first(); if(!$user || !Hash::check($creds['password'],$user->password)) return response()->json(['message'=>'Invalid credentials'],422); $token=$user->createToken('auth')->plainTextToken; return response()->json(['token'=>$token,'user'=>$user]); } public function me(Request $r){ return response()->json($r->user()); } public function logout(Request $r){ $r->user()->currentAccessToken()->delete(); return response()->json(['ok'=>true]); }}
