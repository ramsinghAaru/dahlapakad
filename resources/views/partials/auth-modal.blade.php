<div class='modal fade' id='authModal' tabindex='-1'><div class='modal-dialog'><div class='modal-content bg-dark text-white border-secondary'><div class='modal-header border-secondary'><h5 class='modal-title'>Sign in / Sign up</h5><button class='btn-close btn-close-white' data-bs-dismiss='modal'></button></div><div class='modal-body'><ul class='nav nav-tabs' role='tablist'><li class='nav-item'><button class='nav-link active' data-bs-toggle='tab' data-bs-target='#tab-login' type='button'>Login</button></li><li class='nav-item'><button class='nav-link' data-bs-toggle='tab' data-bs-target='#tab-register' type='button'>Register</button></li></ul><div class='tab-content pt-3'><div class='tab-pane fade show active' id='tab-login'><form id='formLogin'><div class='mb-2'><label class='form-label'>Email or Username</label><input name='login' class='form-control' required></div><div class='mb-2'><label class='form-label'>Password</label><input type='password' name='password' class='form-control' required></div><button class='btn btn-brand w-100'>Login</button></form></div><div class='tab-pane fade' id='tab-register'><form id='formRegister'><div class='mb-2'><label class='form-label'>Name</label><input name='name' class='form-control' required></div><div class='mb-2'><label class='form-label'>Email</label><input name='email' type='email' class='form-control' required></div><div class='mb-2'><label class='form-label'>Username (unique)</label><input name='username' class='form-control' required></div><div class='mb-2'><label class='form-label'>Password</label><input type='password' name='password' class='form-control' required></div><div class='mb-2'><label class='form-label'>Choose an icon</label><select name='avatar' class='form-select'><option value='avatars/tiger.png'>Tiger</option><option value='avatars/robot.png'>Robot</option><option value='avatars/heart.png'>Heart</option><option value='avatars/spade.png'>Spade</option><option value='avatars/diamond.png'>Diamond</option><option value='avatars/club.png'>Club</option></select></div><button class='btn btn-brand w-100'>Create Account</button></form></div></div></div></div></div></div><script>const API=(p)=>`${location.origin}/api${p}`;let TOKEN=null;document.getElementById('formRegister')?.addEventListener('submit',async e=>{e.preventDefault();const body=Object.fromEntries(new FormData(e.target).entries());const r=await fetch(API('/auth/register'),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});const data=await r.json();if(r.ok){TOKEN=data.token;document.getElementById('meUser')?.replaceChildren(document.createTextNode(data.user.username||data.user.name));if(data.user.avatar)document.getElementById('meAvatar').src=`/${data.user.avatar}`;bootstrap.Modal.getInstance('#authModal').hide();}else alert(data.message||'Registration failed');});document.getElementById('formLogin')?.addEventListener('submit',async e=>{e.preventDefault();const body=Object.fromEntries(new FormData(e.target).entries());const r=await fetch(API('/auth/login'),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});const data=await r.json();if(r.ok){TOKEN=data.token;document.getElementById('meUser')?.replaceChildren(document.createTextNode(data.user.username||data.user.name));if(data.user.avatar)document.getElementById('meAvatar').src=`/${data.user.avatar}`;bootstrap.Modal.getInstance('#authModal').hide();}else alert(data.message||'Login failed');});</script>
